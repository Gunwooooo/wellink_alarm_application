---
title: 복약 알림 애플리케이션 개발 일지
created: '2022-04-13T01:20:59.171Z'
modified: '2022-06-30T08:02:41.907Z'
---

# 복약 알림 애플리케이션 개발 일지

2022-04-13

### 해야 할 일
1. 모든 화면 먼저 구성
2. SetAlarmActivity 및 Fragment 작성 (완료)
3. HomeActivity 및 Calendar Fragment 작성 (완료)
4. 회원 정보, 복용 정보, 알람 정보는 모두 로컬에 저장
5. 만약 회원 정보가 저장되어 있다면 바로 캘린더 화면으로 이동 (완료)
6. 달력 스와이프 기능 (완료)
7. 오늘 날짜에 테두리 구현 필요 (완료)
8. 달력 다이얼로그 가로 크기 조절
9. 약 안먹었을 경우 보호자에게 노티 전송
  - 처음에 카카오톡으로 보호자 등록
10. 하단 네비 바 구현 (완료)
11. 달력 스와이프 애니메이션 구현
12. 약 만기일 이후 조회 안되게 


> 틈틈히 필요한 DB 테이블 및 컬럼 workbench에 기록

##### 오늘 할일

1. InputNameFragment UI 작성
  - 입력 자판 바로 출력 (완료)
  - 완료 버튼시 자동 "다음" 클릭 이벤트 발생 (미완료)

2. InputMedicineNameActivity UI 작성 (완료)

3. SetAlarmPeriodActivity UI 작성 (완료)

4. SetAlarmTimeActivity UI 작성 (완료)
  - 툴바 뒤로가기 구현 (완료)
  - 프로그레스 바 구현 (완료)


- 캘린더 API 정보 검색
  - https://github.com/miso01/SingleRowCalendar(miso)
  - https://github.com/SimpleMobileTools/Simple-Calendar(SimpleMobileTools)

---

2022-04-14

##### 오늘 할일

1. SetAlarmActivity 구성 후 초기 설정 및 약 설정에 대한 화면은 fragment로 설계
  - SetUserNameFragment, SetAlarmNameFragment, SetAlarmPeriodFragment, SetAlarmTimeFragment

2. layout -> layouts의 폴더에 각각 분류하여 보기 쉽게 정리 (완료)

3. gradle의 android-kotlin-extensions 제거 후 viewBinding 요소 추가 후 사용 (완료)
  - android 4.1부터 extensions 플러그인 완전히 제거됨
  - RecyclerView에서 문제 발생
  - 동일한 id를 가진 서로 다른 widget

4. fragment 생성 후 commit할 때의 종류 네 가지

5. 키보드 올라올 때 버튼 같이 올리기 (완료)
 - 매니페스트 해당 액티비티에서 android:windowSoftInputMode="adjustResize" 추가
    - 이렇게 하면 모든 화면이 함께 올라가므로 화면이 깨짐
    - 프레임 레이아웃을 이용하면 윗부분 화면은 고정시킬 수 있음
``` xml
<LinearLayout android:orientation="vertical"
        android:layout_width="match_parent"
        android:layout_height="match_parent">
    <FrameLayout android:id="@+id/my_content"
            android:layout_width="match_parent"
            android:layout_height="0dip"
            android:layout_weight="1">
        <!-- Your content here -->
    </FrameLayout>
    <LinearLayout android:id="@+id/my_toolbar"
            android:layout_width="match_parent"
            android:layout_height="wrap_content">
        <!-- Your toolbar items here -->
    </LinearLayout>
</LinearLayout>
```

---

2022-04-18

- Fragment에는 setContentView가 없음

- 키보드 첫 액티비티 시작 시 올리는 법
    - editText xml에 <requestFocus/> 추가

1. progressBar 설정
  - 색깔은 theme에서 colorAccent를 설정하면 자동으로 색 설정됨

2. fragment에서 fragment로 전환은 자신의 하위레벨이 아니기 때문에 직접 제어 불가능
  - 따라서 상위 레벨인 Activity에 프레그먼트 이동 메서드 정의 후 호출

3. live template를 이용해 logd 자동 완성 설정

4. 뷰바인딩이랑 데이터바인딩은 다르다
  - 뷰바인딩은 findById를 안쓰기 위한 도구
  - 데이터바인딩은 MVVM 모델을 이용하기 위한 툴

5. 프레그먼트에서 뷰바인딩을 이용하기 위해 BaseFragment 추상 클래스 생성 후 상속받아서 fragment 만들기

6. 프래그먼트 뒤로가기 구현 필요

---

2022-04-20

1. 뒤로가기 SEtUserNameFragment에서만 숨기고 (완료)
  - 나머지는 Constants에 이전 fragment저장 후 뒤로가기 구현

---

2022-04-21

1. Full screen 달력 API 찾기
  - API는 찾을 수 없고 직접 코드보고 만드는게 낫다.
https://namget.tistory.com/entry/%EC%95%88%EB%93%9C%EB%A1%9C%EC%9D%B4%EB%93%9C-%EC%95%88%EB%93%9C%EB%A1%9C%EC%9D%B4%EB%93%9C-%EC%BB%A4%EC%8A%A4%ED%85%80-%EB%8B%AC%EB%A0%A5-%EC%98%88%EC%A0%9C-Android-Custom-CalendarView-Example

2. HomeCalendarActivty 구성 후 Toolbar에 로고 및 마이 페이지 아이콘 넣기

---

2022-04-25

1. 데이터 바인딩 활용한 달력 개발
  - recyclerView와 databinding 활용
  - ``` TextBindingAdapter is not static and requires an object to use, retrieved from the DataBindingComponent. If you don't use an inflation method ... ``` 오류 발생
    - Kotlin에서 xml Textbinding 코드는 static으로 작성되어야 함
    - 코드를 companion object로 작성하고 @JvmStatic 상단에 추가
    - recyclerView 다시 공부 필요

---

2022-05-02

1. 달력 구현
  - 풀 스크린 가로 스와이프 가능한 달력 구현 필요
  - 좀 더 직관적인 UI 개발을 위해 데이터 바인딩 기능 제거 (완료)
  - 한 페이지에 날짜 데이터 개수 42개로 고정 (완료)
  - 토, 일 및 다음달, 이전달 데이터 색깔 흐리게 변경 (완료)
  - 이전, 다음 달 버튼 구현 (완료)
  - 이전달, 다음달 item.xml을 각각 구현 후 viewBinding해서 터치 시 달 이동 가능 하도록 개발(완료)

---

2022-05-03

1. CalendarAdapter에서 이벤트 처리할 것 인가 or 
  - HomeCalendarFragment에서 처리할 것 인가
  - 어뎁터에서 OnItemClickListener 인터페이스를 만든 후 viewholder에서 각각 연결
  - HomeCalendarFragment에서 object로 클릭 리스너 설정하는 방식으로 구현 (완료)
2. 오늘 날짜에 테두리 보이게
  - 클릭 시 테두리 보이게 
  - textView에 background로 radius 및 color 지정(완료)
  - 이전 꺼 지우는 기능 필요
  - 1. 우선 처음에 오늘 날짜에 해당하는 인덱스 저장
  - 2. 인덱스 계산법은 전월 개수에 오늘 날짜를 더한다
  - 3. 이를 다시 prevCHoiceDay:Int 에 저장해두고
  - 4. click event 발생 시 전 월 border를 아무 것도 없는 border로 만들고
  - 5. 해당하는 position의 view를 recyclerView의 findViewByPosition을 통해 border 생성

---

2022-05-04

1. 달력 테두리 보이기 (완료)

2. 이전 날짜에 테두리 없애기 (완료)

2022-05-09

1. 처음 달력에서는 오늘 날짜에 테두리 뜨도록 구현 필요 (보류)

2. 스와이프 시 화면 전환 구현 필요 (보류)
  - OnTouchListener와 GestureListener를 이용해서 구현 실패
  - Fragment에서는 작동하지 않는 듯 함
  - recyclerView에 내장된 기능 찾기 (없음)

---

2022-05-10

##### 오늘 할일

1. 달력 클릭 시 다이어로그 출력
  - 커스텀 다이어로그로 설정
  - 커스텀 다이어로그 출력 가능
  - 가로 사이즈 조절이 안됨 (보류)
2. day item에 들어갈 내용 구상 및 클릭 이벤트 수정
  - linearlayout에 event 설정

---

2022-05-11

##### 오늘 할일

1. day item에 들어갈 내용 구상
  - 안먹은 것만 표시

2. 달력 스와이프 기능 구현 (미완)

---

2022-05-12

##### 오늘 할일

1. 달력 스와이프 기능 구현 마무리 하기 (완료)
  - onFling에서 e1: MotionEvent가 null값이 출력이 됨
  - onTouch에서 터치 event 값은 제대로 로그가 찍임
  - arrayList에 모두 저장시켜서 처음 인덱스와 마지막 인덱스를
  - onFling에서 e1, e2 값으로 사용

2. recyclerVIew의 스와이프 이벤트 중첩을 위해 overScrollMode=never로 설정

3. item view에는 체크 이미지 넣기?

4. 하단 네비게이션 바 만들기 (완료)

---

2022-05-13

##### 오늘 할일

1. 달력 하단 네비게이션 색상 변경 (완료)
  - drawble에 selecor를 만드니 접근 불가
  - res에 color 디렉터리를 만들고 거기에 저장하면 접근 가능

2. 바텀 네비게이션 프래그먼트 전환 구현 (완료)
  - setOnItemSelectedListener를 통해 각각 프래그먼트 전환 구현

3. 마이페이지 액티비티 화면 전환 구현 (완료)

---

2022-05-16

##### 오늘 할 일

1. 내 약 관리 프래그먼트 구성 (완료)
  - cardView를 이용해 구성 완료
  - recyclerView 필요
2. 약/약물 검색 프래그먼트 구성 (완료)
  - EditText 작업
  - recyclerView 필요
  - 검색 기능 필요
2. 마이페이지 액티비티 구성 (완료)

3. home activity에서 뒤로가기 두번 시 종료 구현 (완료)
```java
moveTaskToBack(true); // 태스크를 백그라운드로 이동
finishAndRemoveTask(); // 액티비티 종료 + 태스크 리스트에서 지우기
exitProcess(0);
```
  - 앱 종료 후 다시 실행 했을 경우 프래그먼트가 남아있어서
  - 프래그먼트가 뜨는 현상 발생
  - finishAffinity() 사용 해결 (완료)

4. setNameFragment를 activity로 빼고 (재활용을 위해)
  - setAlarmNameFragment를 처음 시작 (완료)
  - 뒤로가기 버튼 없애기 (완료)

2022-05-17

##### 오늘 할 일

1. 약 알람 추가 스토리 구성 및 DB설계

2. 알람 주기 numberPicker 화면 구성 및 구현
  - backgounr 색깔 변경
  - setBackgroundResource(R.drawable. ---)
  - text 색깔 변경
  - setTextColor(COntextCompat.getColor(context, R.color. ---))
  - numberPicker 구현 완료 
  - style, theme 설정으로 텍스트 크기 및 색상 변경

2022-05-18

##### 오늘 할 일

1. 새로운 프로젝트 오픈했는데 sdk경로를 못찾고 run 버튼이 비활성화 되는 현상이 발생 
  - 안드로이드 스튜디오 재설치해도 동일한 현상
  - sdk 삭제 후 재설치해도 동일
  - 프로젝트 캐쉬 제거 후 최근 프로젝트 리스트에서 모두 제거하고 다시 새 프로젝트 생성
  - 폴더 잘 못 열고 있었음..;
  - 해결 완료

2. 약 알람 등록 기능 (완료)
  - 이름, 주기, 회분, 아점저취 시간 및 toggle을 저장하면서 입력받기
  - 약 이름 입력받기 완료
  - 주기, 회분 입력받기 완료
      - util Const object에 데이터 전역으로 저장

3. 시간 설정 카드뷰 클릭 시 시간 선택 다이어로그 출력 구현 (완료)
  - 타임피커다이어로그로 시간 가져오기
  - 스피너모드 사용
  - 스위치 기능 구현 필요
  - Compound.OnCheckedChangedListender 상속

2022-05-19

##### 오늘 할 일

1. 알람 데이터 sqlite DB에 저장하기
  
2. sharedPreference로 사용자 이름 저장하기
  - 유저 이름이 있으면 바로 HomeActivity로 이동
  - 없으면 setUserNameActivity로 이동

3. 마이페이지에 데이터 초기화 시 유저 네임 "" 로 바꾸고 MainActivity로 이동 (완료)

2022-05-20

##### 오늘 할일

1. SQLite를 이용해 알림 데이터 insert 구현 (완료)

2. select 구현 (완료)
  - recyclerView를 이용해 알람 리스트 출력 (완료)

2022-05-23

##### 오늘 할일

1. 알람 delete 구현 (완료)

2022-05-24

##### 오늘 할 일

1. 알람 삭제 다이어로그 구현 (완료)
  - 기존에 다이어로그에 layout을 인자로 받아 커스텀 다이어로그 구성

2. 다이어로그 버튼 클릭 리스너 구현 (완료)
  - 인터페이스를 이용해 main에서 리스너 구현

3. 오늘 날짜 테두리 표시 (완료)
  - rv의 doOnPreDraw에 함수 구현

4. 캘린더 날짜 클릭 다이어로그 데이터 베이스 구상

2022-05-26

### 오늘 할 일

1. 캘린더 다이어로그 일자 표시 (완료)

2. DB에 등록 일자 저장 (완료)

3. 다이어로그에 표시할 약 정보 select하기 (완료)
  - 만기일이 안지났고
  - (클릭날짜 - 시작날짜)%알람 주기 == 0 일경우 가져오기 쿼리문 작성
  - 클릭시 현재 날짜 시간 sdf로 다이어로그 fragment에 전달

2022-06-02

##### 오늘 할 일

1. 달력 특정 날짜 클릭 시 해당하는 약 정보 가져와서 출력하기 (완료)

2. 약 정보 수정 sqlite update query를 입력해 구현 (완료)

3. 약 정보 등록에서 중복 이름 등록 예외 처리
  for문으로 중복 체크

---

2022-06-03

##### 오늘 할 일

1. 알람 리시버 구현하기

2. 알람 울리게 구현하기

---

2022-06-08

##### 오늘 할 일

1. 알람 울리게 구현 (완료)
  - 각각의 알람을 구별하기 위해 requestCode를 다르게 주어야함
  - 그래서 alarm table에 autoincrement로 id를 줘서 그것을 알람 아이디로 사용

2. 알람 주기 및 끝나는 기간 설정

3. 알림 시 화면 띄우기
  - 락 걸려있어도 화면 켜짐 activity 실행


2022-06-09

##### 오늘 할 일

1. 앱이 종료 됐을 때도 기존의 알람 처럼 화면을 출력하고 싶은데 방법을 못찾겠음

2. startService 가 동작하지 않을 경우
  - VERSION 체크를 통해 startForegroundService를 병행해서 사용하여 해결

3. service 호출 까지는 확인
  - service에서 activity 호출 구현
  - Calling startActivity() from outside of an Activity  context requires the FLAG_ACTIVITY_NEW_TASK flag. Is this really what you want?
  에러 발생
  - 서비스는 태스크가 없기 때문에 액티비티를 시작하려면 new task 플래그를 줘야 한다고 한다.
- startActivity(it.addFlags(FLAG_ACTIVITY_NEW_TASK)); 추가
출처: https://yonoo88.tistory.com/1057 [yonoo's:티스토리]
- 앱이 켜진 상태에서는 정상적으로 액티비티 실행 확인
- 앱이 꺼진 상태에서는 에러 메세지 없이 앱 종료..


2022-06-13

##### 오늘 할 일

1. 알람 소리가 들리다가 10초 정도 후에 종료되면서 앱 에러 발생 (해결 완료)

> android.app.RemoteServiceException: Context.startForegroundService() did not then call Service.startForeground(): ServiceRecord{f3e4107 u0 com.hanait.wellinkalarmapplication/.service.AlarmService}

해결 방법 :  startForegroundService()으로 서비스가 실행되면, 실행된 서비스는 5초 내에 startForeground()를 호출하여 서비스가 실행 중이라는 Notificaiton을 등록해야 합니다. 만약 호출하지 않으면, 시스템은 서비스를 강제로 종료시킵니다.

Service.startForeground()는 다음과 같이 Notificaiton ID와 Notificaiton 객체를 인자로 받습니다. 주의할 점은 ID로 0을 전달하면 동작이 안된다는 것입니다. 0을 제외한 다른 숫자를 ID로 전달해야 합니다.

버전 체크 후 startForground() 다시 호출 필요

출처 : https://codechacha.com/ko/android-start-foreground-service/

2. 알람 설정 시 이전 약 복용 시간이 같이 호출되는 문제 발생 (해결 완료)

  - 이미 지나버린 알람이 함께 울리는 문제가 발생
  - 이미 지나버린 시간 알람은 add date, 1 하여 날짜를 뒤로 미룸

2022-06-14

##### 오늘 할 일

1. 알람 소리 알림 및 오류 잡기 완료

2. 알람 화면 띄우기 (완료)
  - 앱 종료 상태일 경우 화면 안뜸
  - 따로 intent를 실행하지 않고  notification에 fullScreenIntent로 구현해서 해결

3. 팝업 acitivty에서 뒤로가기 누를 경우 앱 느려지는 현상 발생
  - 하단 소프트키와 스테이스바를 숨기고 버튼으로만 화면 제어 가능하게 구현
  - 참고 : https://altongmon.tistory.com/395

2022-06-15

##### 오늘 할 일

1. 깃 커맨드로 커밋하기
  - SSH 생성 후 등록하기 완료

2. 노티 클릭 시 제거하기


2022-06-16

##### 오늘 할 일

1. 노티 클릭 시 제거 (완료)
  - NotificationCompat.Builder 에 setContentIntent 하지 않으면
  아무리 setAutoCancel 을 true로 줘도 사라지지 않더군요...
  - 알림 취소 reciever 및 service 호출은 구현 완료 -> 미디어 재생 종료 됨
  - 기존의 notification 생성 코드에서  startForeground를 하지않고 
  - notificationManager의 notify() 로 실행하였더니 정상 작동
  
2. 앱 완전 종료 구현 완료


2022-06-17

##### 오늘 할 일

1. 알람 시간 중복 처리
  - 알림이 태양이는 각각의 알람의 노티를 띄움
  - 그렇게 동일하게 구현
  - 위 코드에서 첫번째 파라미터의 값을 동일 하지 않게 넣어주시면 여러개의 notification 을 볼 수 있습니다.
```
출처: https://iw90.tistory.com/220 [woong's:티스토리]
  - notification id를 다르게 주면 각각의 notification 설정 가능
```
  - 각각 노티 띄우기 성공
  - popup 인텐트로 pendingId 전달 안됨 에러
  

2022-06-20

##### 오늘 할 일

1. popupActivity로 service에서 putExtra가 안됨
  - PendingIntent.getAcitivy의 네번째 인자를 0이 아닌 
  - PendingIntent.FLAG_UPDATE_CURRENT로 설정하면 제대로 동작

  ``` 
  https://stackoverflow.com/questions/30460932/send-putextra-via-notification-intent
  ```

2022-06-21

##### 오늘 할 일

1. 팝업 액티비티 UI 수정 

2. 알림 소리 5초 정도 지속되다가 강제로 destroy 됨 (완료)
  - startForeground() 를 서비스에 추가 해결

3. startForeground() 를 추가하니 노티가 꺼지지 않는 문제 발생 (완료)
  - 복용 버튼 눌렀을 때 stopSelf() 호출해서 해결

4. 특정 시간 지나면 stopSelf()가 호출되도록 개발
  - 미복용으로 인지
  ``` 
  https://jamesy.tistory.com/29
  ```

2022-06-22

##### 오늘 할 일

1. 복용 버튼 클릭 시 DB taken값 수정 (완료)

2. 딜레이 1분으로 약 미복용 토스트 출력 Handler에 약 복용버튼 클릭 시 
  - if문을 추가해서 동작 안되게 수정

3. 미디어 플레이어가 재생중이라면 재생 안되도록 수정 (알람 중복 울림)

4. 캘린더에서 특정 날짜 클릭 시 복용 약 뜨는 다이어로그
  - 복용 여부에 따라 글자 색 변경
  - spannableString을 이용해  특정 인덱스 글자 색 변경 방식
  - 동적으로 textview를 추가하는 방식
  - 전자는 string 연산을 이용하므로 비효율적이라 생각
  - 후자로 개발
  
5. textView activity에서 설정
  - font설정 방식은 setTypeface 이용
  - 부모에 붙이는건 하나의 view만 가능하므로 불가능
```
TextView tv = (TextView) findViewById(R.id.appname);
Typeface face = Typeface.createFromAsset(getAssets(),
            "fonts/epimodem.ttf");
tv.setTypeface(face);
```

6. 다이어로그 위의 방법 시 텍스트 일부 색깔 변경에 번거로움이 따름
  - 복용 / 미복용을 UI 재구성하여 개발

2022-06-23

##### 오늘 할 일

1. 달력 상세 다이어로그 UI 변경 및 텍스트 일부분 색상 변경
  - spannableString 이용
  - string이 null일 경우 예외처리 필요(해야함)
2. MediaPlayer를 시작하는 코드에서 에러 발생
  - create 하기전에 isPlaying 호출해서 오류 발생
  -> 해결 완료

2022-06-27

##### 오늘 할 일

1. 달력 다이어로그 일부분 색상 변경 코딩(완료)

2. 실수로 DB 설계를 날짜 별 복용 유무 따로 설계 안함
  - taken 정보를 요일별로 따로 빼기..
  - DB 재설계 필요
  - calendar table 새로 만들어서 날짜별 복용 유무 정보 저장
  - 복용 예정일은 그대로 놔두기
  - 알람이 울릴 때 복용 유무도 함께 저장( 복용 예정일은 따로 저장 X )

2022-06-28

##### 오늘 할 일

1. 캘린더 DB설계 계속

2. delete dialog 크기 조절

3. popupactivity에서 calendar 가져오기 및
  - 가져온 데이터에서 중복있나 검색 후 
  - 없으면 insert 있으면 modify
  - 달로 가져오기 및 이름, 날짜로 가져오기 구현

4. DatabaseManager list[0] null처리

2022-06-29

##### 오늘 할 일

1. databaseManager null 처리 계속
  - 완료
  - calendarData DB에 insert or update 구현 완료
  - select as id and name  /  select as month 구현 완료

2. 알람 시간 설정 시 자동 스위치 온 구현 (완료)

3. 캘릴더 상세 화면 글씨 색깔 부분 변경 (완료)
  - select as month로 해당 날짜의 복용 정보 가져와서
  - for문에서 각각 복용유무 비교 후 글자 색 변경

4. homeAlarmFragment에 floating버튼 만들기(약 추가)
  - floatingButton이 화면에 잘리는 현상 발생
  - gravity bottom이 설정 안됨
  - margin으로 위치 조정

5. 캘린더 월 변경 시 테두리 뜨도록 구현(1일)
  - 오른쪽 상단에 달력 아이콘 추가 -> "복용 달력" 버튼과 동일한 이벤트 발생

2022-06-30

##### 오늘 할 일

1. 캘린더 아이콘 표시
  calendar fragment에서 데이터 가져와서 hash로 미복용 갯수 저장
  - 복용 정보가 없는 날에는 아무것도 표시하지 않기 
  - Hashmap<"날짜", 갯수>
  - 해당 날짜에 총 알람 갯수 파악 필요
